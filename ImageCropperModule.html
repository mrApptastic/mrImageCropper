<!DOCTYPE html>
<html>
<head>
<title>ImageCropperModule</title>
<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<link rel='stylesheet' href='http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css'>
<script src= 'http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js'></script>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>
<script src='http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js'></script>
<script src='https://use.fontawesome.com/dc7038f777.js'></script>
<style>
#imageCropper {
	box-shadow: 5px 5px 10px grey;
}

#rightBar {
	margin-left: 0;
	left: 0;
	height: 150px; 
	width: 10px; 
	display: inline-block;
}

#rightBar:hover {
	cursor: e-resize;
}

#bottomBar {
	margin-top: 0;
	top: 0;
	height: 10px; 
	width: 300px;
}

#bottomBar:hover {
	cursor: s-resize;
}

#slider {
position: absolute;;
width: 8px;
background: silver;
height: 100%;
left: 0;
transition: 0.1s;
}

#slider:hover {
transition: 0.2s;
box-shadow: 2px 2px 1px grey, 4px 4px 2px snow, 6px 6px 3px Lavender, -3px -3px 5px lavenderblush, -3px 3px 2px navajowhite, 3px -3px 2px mintcream, inset 3px 3px 0 grey, inset -3px -3px 0 grey;
cursor:w-resize;
}	

#editField {
	border-radius: 5px;
    // box-shadow: 2px 2px 1px grey, 4px 4px 2px snow, 6px 6px 3px Lavender, -3px -3px 5px lavenderblush, -3px 3px 2px //navajowhite, 3px -3px 2px mintcream, inset 3px 3px 0 grey, inset -3px -3px 0 grey;
    background: rgba(133,133,123,0.9);
    width: 350px;
    padding: 10px;
	top: 0;
	right:0;
	height: 100%;
	position:fixed;
	z-index: 998;
	transition: 0.1s;	
	}
</style>
</head>
<body>
<div id="imageZone">
<div>
<canvas id="imageCropper"></canvas>
<div id="rightBar"></div>
<div id="bottomBar"></div>
</div><br/>
</div>
<div style="right:0;top:0;position:fixed;z-index: 999; color: #777" class="textBandit"><label>Hide</label><input id="hideTools" type="checkbox" /></div>
<div id="editField" >
<div id="slider"></div>
<div style="margin-left: 12px;">
    <label>Upload</label><input type="radio" name="inputType" value="0" checked />
    <label>URL</label><input type="radio" name="inputType" value="1" />
    <span class="viewBandit">
		<input type='file' id="imgInp" />
    </span>
    <span class="viewBandit" style="display: none;">
        <input id="URLBandit" type="text" placeholder="Image URL" style="width: 100%" />
    </span>
    <label>Bredde: </label><input id="canvasWidth" class="input-sm canvasBandit" type="number" value="300"/><br/>
    <label>H&oslash;jde: </label><input id="canvasHeight" class="input-sm canvasBandit" type="number" value="150"/><br/>
    <label>St&oslash;rrelse (%): </label><input id="canvasScale" class="input-sm canvasBandit" type="number" value="100"/><br/>
    <label>Forskydning X: </label><input id="canvasLeft" class="input-sm canvasBandit" type="number" value="0"/><br/>
    <label>Forskydning Y: </label><input id="canvasTop" class="input-sm canvasBandit" type="number" value="0"/><br/>
    <button id="clearRectBandit">Clear</button><br/>
	<label>Tegnev&aelig;rkt&oslash;jer:</label>
	<input id="showDrawingTools" type="checkbox"/>
	<div id="drawingTools" style="display: none;">
		<label>Penselst&oslash;rrelse: </label><input id="canvasBrush" class="input-sm" type="number" value="5"/><br/>
		<label>Penselfarve: </label><input id="canvasBrushColour" class="input-sm" type="text" value="Black"/><br/>
	</div>
	<label>Filtre</label>	
	<input id="showFilters" type="checkbox" />
	<div id="filters" style="display: none;">
		<label>Gr&aring;tone: </label><button id="grayScaleFilter">Change</button><br/>
		<label>Inverteret: </label><button id="invertFilter">Change</button><br/>
		<label>Lys: </label><input id="brightnessFilter" type="number" value="0"/><br/>
		<label>R&oslash;d: </label><input id="redFilter" type="number" value="0"/><br/>
		<label>Gr&oslash;n: </label><input id="greenFilter" type="number" value="0"/><br/>
		<label>Bl&aring;: </label><input id="blueFilter" type="number" value="0"/><br/>
		<label>Alpha: </label><input id="alphaFilter" type="number" value="0"/><br/>
		<label>Threshold: </label><input id="thresholdFilter" type="number" value="0"/><br/>
		<label>Noise: </label><input id="noiseFilter" type="number" value="0"/><br/>
		<label>Saturate: </label><input id="saturateFilter" type="number" value="0"/><br/>						
	</div>
	<input placeholder="Billednavn" id="fileText" type="text" name="fileText"/>
	<input placeholder="Filtype" id="fileType" type="text" name="fileType"/><br/>
	<textarea placeholder="Beskrivelse" style="width:100%;" id="fileDescription" type="text" name="fileDescription"></textarea>
	<button id="downloadBandit">Download</button>
	<div ng-controller="uploadController">
	<button ng-click="upload()">Upload</button>
	</div>
</div>
</div>
</div>
<script>
var huhu = new Image();
var ct =  document.getElementById('imageCropper').getContext('2d');
var draw = false;
var resizeX = false;
var resizeY = false;
var moveCoords = [null,null,null,null];
var sliding = false;
ct.fillStyle = document.getElementById('canvasBrushColour').value;
document.getElementById('canvasBrushColour').style.color = ct.fillStyle = document.getElementById('canvasBrushColour').value;

function readURL(input) {
    if (input.files && input.files[0]) {
		var reader = new FileReader();          
        reader.onload = function (e) {
            huhu.src = e.target.result;
            document.getElementById("fileText").value = replaceInvalidCharacters(input.files[0].name.split(".")[0]);
			document.getElementById('fileDescription').value = input.files[0].name.split(".")[0];
			document.getElementById("fileType").value = input.files[0].name.split(".")[1];
			ct.clearRect(0,0,document.getElementById('canvasWidth').value,document.getElementById('canvasHeight').value);
            setTimeout(reDrawImage,50);
        }            
        reader.readAsDataURL(input.files[0]);
    }
}

function resizeCanvas() {
	var w = document.getElementById('canvasWidth').value;
	var h = document.getElementById('canvasHeight').value;
	document.getElementById('rightBar').style.height = document.getElementById('canvasHeight').value + "px";
	document.getElementById('bottomBar').style.width = document.getElementById('canvasWidth').value; + "px";
	document.getElementById('imageCropper').setAttribute('width', w);
	document.getElementById('imageCropper').setAttribute('height', h);
}

function reDrawImage() {
    var scale = document.getElementById("canvasScale").value;
    var left = document.getElementById("canvasLeft").value;
    var top = document.getElementById("canvasTop").value;
    ct.drawImage(huhu,left,top, huhu.width*(scale/100), huhu.height*(scale/100));
}

function downloadImage(filename, text) {
    var l = document.createElement('a');
    l.setAttribute('href', text);
    l.setAttribute('download', filename);
    if (document.createEvent) {
        var event = document.createEvent('MouseEvents');
        event.initEvent('click', true, true);
        l.dispatchEvent(event);
    }
    else {
        l.click();
    }
}
  
function replaceInvalidCharacters (inputSring) {
inputSring = inputSring.replace(/\s+/g,'_');
var outputString = "";
for (var i = 0; i < inputSring.length; i++) {
	if (inputSring.charCodeAt(i) < 127 && inputSring.charCodeAt(i) > 32) {
		outputString += inputSring.charAt(i);
	}
}
return outputString;
}

function changeInput(bo) {
     for (var i = 0; i < document.getElementsByClassName("viewBandit").length; i++) {
          document.getElementsByClassName("viewBandit")[i].style.display = "none";
     }
     document.getElementsByClassName("viewBandit")[bo].style.display = "block";
}

 function grayScale(id) {
	var context =  document.getElementById(id).getContext('2d');
	var canvas = document.getElementById(id);
	if (context != null) {
		    var imgData = context.getImageData(0, 0, canvas.width, canvas.height);
        var pxl  = imgData.data;
        for (var i = 0, n = pxl.length; i < n; i += 4) {
        var grayscale = pxl[i] * .3 + pxl[i+1] * .59 + pxl[i+2] * .11;
        pxl[i  ] = grayscale;
        pxl[i+1] = grayscale;
        pxl[i+2] = grayscale;
    }
    context.putImageData(imgData, 0, 0);
  }
  };
  
function invert(id) {
	var context =  document.getElementById(id).getContext('2d');
	var canvas = document.getElementById(id);
	if (context != null) {
		var imgData = context.getImageData(0, 0, canvas.width, canvas.height);
		var pxl  = imgData.data;
	for (var i = 0; i < pxl.length; i+= 4) {
		pxl[i] = (255 - pxl[i]);
		pxl[i+1] = (255 - pxl[i+1]);
		pxl[i+2] = (255 - pxl[i+2]);
	}
	context.putImageData(imgData, 0, 0);
	}
} 

function brighten(id,adjustment) {
	var context =  document.getElementById(id).getContext('2d');
	var canvas = document.getElementById(id);
	if (context != null) {
		var imgData = context.getImageData(0, 0, canvas.width, canvas.height);
		var pxl  = imgData.data;
	for (var i=0; i< pxl.length; i+=4) {
		pxl[i] -= adjustment;
		pxl[i+1] -= adjustment;
		pxl[i+2] -= adjustment;
	}
	context.putImageData(imgData, 0, 0);
	}
}

function makeRed(id,adjustment) {
	var context =  document.getElementById(id).getContext('2d');
	var canvas = document.getElementById(id);
	if (context != null) {
		var imgData = context.getImageData(0, 0, canvas.width, canvas.height);
		var pxl  = imgData.data;
	for (var i=0; i< pxl.length; i+=4) {
		pxl[i] -= adjustment;
	}
	context.putImageData(imgData, 0, 0);
	}
}

function makeGreen(id,adjustment) {
	var context =  document.getElementById(id).getContext('2d');
	var canvas = document.getElementById(id);
	if (context != null) {
		var imgData = context.getImageData(0, 0, canvas.width, canvas.height);
		var pxl  = imgData.data;
	for (var i=0; i< pxl.length; i+=4) {
		pxl[i+1] -= adjustment;
	}
	context.putImageData(imgData, 0, 0);
	}
}

function makeBlue(id,adjustment) {
	var context =  document.getElementById(id).getContext('2d');
	var canvas = document.getElementById(id);
	if (context != null) {
		var imgData = context.getImageData(0, 0, canvas.width, canvas.height);
		var pxl  = imgData.data;
	for (var i=0; i< pxl.length; i+=4) {
		pxl[i+2] -= adjustment;
	}
	context.putImageData(imgData, 0, 0);
	}
}

function makeAlpha(id,adjustment) {
	var context =  document.getElementById(id).getContext('2d');
	var canvas = document.getElementById(id);
	if (context != null) {
		var imgData = context.getImageData(0, 0, canvas.width, canvas.height);
		var pxl  = imgData.data;
	for (var i=0; i< pxl.length; i+=4) {
		pxl[i+3] -= adjustment;
	}
	context.putImageData(imgData, 0, 0);
	}
}

function threshold(id,threshold) {
	var context =  document.getElementById(id).getContext('2d');
	var canvas = document.getElementById(id);
	if (context != null) {
		var imgData = context.getImageData(0, 0, canvas.width, canvas.height);
	    var pxl  = imgData.data;
		for (var i=0; i < pxl.length; i+=4) {
			var r = pxl[i];
			var g = pxl[i+1];
			var b = pxl[i+2];
			var v = (0.2126*r + 0.7152*g + 0.0722*b >= threshold) ? 255 : 0;
			pxl[i] = pxl[i+1] = pxl[i+2] = v
		}
		context.putImageData(imgData, 0, 0);
	}
}

function noise(id,adjustment) {
	var context =  document.getElementById(id).getContext('2d');
	var canvas = document.getElementById(id);
	if (context != null) {
		var imgData = context.getImageData(0, 0, canvas.width, canvas.height);
		var pxl  = imgData.data;
	for (var i=0; i< pxl.length; i+=4) {
		let random = (0.5 - Math.random()) * adjustment;
		pxl[i] += random;
		pxl[i+1] += random;
		pxl[i+2] += random;
	}
	context.putImageData(imgData, 0, 0);
	}
}

function saturate(id,adjustment) {
	var context =  document.getElementById(id).getContext('2d');
	var canvas = document.getElementById(id);
	if (context != null) {
		var imgData = context.getImageData(0, 0, canvas.width, canvas.height);
		var pxl  = imgData.data;
	for (var i=0; i< pxl.length; i+=4) {
		let thispixel = new Array(0);
		thispixel[0] = pxl[i];
		thispixel[1] = pxl[i+1];
		thispixel[2] = pxl[i+2];
		let rgb = saturatePixel(thispixel);	
		pxl[i] = rgb[0];
		pxl[i+1] = rgb[1];
		pxl[i+2] = rgb[2];
	}
	context.putImageData(imgData, 0, 0);
	}
}

function saturatePixel (pixel, factor) {
	var hsl = RGBtoHSL(pixel);
	hsl[1] *= (factor);
	return HSLtoRGB(hsl);
}

function RGBtoHSL (rgb) {
		var r = rgb[0],
		    g = rgb[1],
		    b = rgb[2];
		
		r /= 255;
		g /= 255;
		b /= 255;
		
		var max = Math.max(r, g, b),
		    min = Math.min(r, g, b),
		h, s, l = (max + min) / 2;

		if (max === min) {
			h = s = 0; // achromatic
		} else {
			var d = max - min;
			s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
			switch (max) {
			    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
			    case g: h = (b - r) / d + 2; break;
			    case b: h = (r - g) / d + 4; break;
			}
			h /= 6;
		}

return [h, s, l];
    }

function HSLtoRGB (hsl) {
		// in JS 1.7 use: var [h, s, l] = hsl;
		var h = hsl[0],
		    s = hsl[1],
		    l = hsl[2],
		
		r, g, b,
		
		hue2rgb = function (p, q, t){
		    if (t < 0) {
		    	t += 1;
		    }
		    if (t > 1) {
		    	t -= 1;
		    }
		    if (t < 1/6) {
		    	return p + (q - p) * 6 * t;
		    }
		    if (t < 1/2) {
		    	return q;
		    }
		    if (t < 2/3) {
		    	return p + (q - p) * (2/3 - t) * 6;
		    }
		    return p;
		};
		
		if (s === 0) {
			r = g = b = l; // achromatic
		} else {
			var
			q = l < 0.5 ? l * (1 + s) : l + s - l * s,
			p = 2 * l - q;
			r = hue2rgb(p, q, h + 1/3);
			g = hue2rgb(p, q, h);
			b = hue2rgb(p, q, h - 1/3);
		}

return [r * 0xFF, g * 0xFF, b * 0xFF];
    }
	
	/*
by converting to the HSV (hue, saturation and value) format you can manually change the S component in this manner:

var hsv= RGBtoHSV ([200,100,100]);
alert(hsv)
hsv[1] *= 1.5;
alert(hsv)
var rgb= HSVtoRGB(hsv);
alert(rgb); //new color
*/



document.getElementById("imgInp").addEventListener("change", function() {
    readURL(this);
});

for (var i = 0; i < document.getElementsByClassName("canvasBandit").length; i++) {
document.getElementsByClassName("canvasBandit")[i].addEventListener("change", function() {
    resizeCanvas();
    reDrawImage();
});
}

document.getElementById('imageCropper').addEventListener("mousedown", function(event) {
    draw = true;
	if (document.getElementById("showDrawingTools").checked != true) {
		document.getElementById('imageCropper').style.cursor = "grabbing";
		var x = parseInt(document.getElementById("canvasLeft").value);
		var y = parseInt(document.getElementById("canvasTop").value);
		moveCoords[0] = ((-x + event.pageX) - document.getElementById('imageCropper').offsetLeft);
		moveCoords[1] = ((-y + event.pageY) - document.getElementById('imageCropper').offsetTop);
	}
});

document.getElementById('imageCropper').addEventListener("mouseup", function(event) {
    draw = false;
	if (document.getElementById("showDrawingTools").checked != true) {
		document.getElementById('imageCropper').style.cursor = "grab";
		moveCoords = [null,null,null,null];
	}
});

document.getElementById('imageCropper').addEventListener("mouseover", function(event) {
	if (document.getElementById("showDrawingTools").checked != true) {
		document.getElementById('imageCropper').style.cursor = "grab";
	}
	else {
		document.getElementById('imageCropper').style.cursor = "default";
	}

});

document.getElementById('imageCropper').addEventListener("mouseleave", function(event) {
	document.getElementById('imageCropper').style.cursor = "default";
    draw = false;
});

document.getElementById('imageCropper').addEventListener("mousemove", function(event) {
    if (draw == true && document.getElementById("showDrawingTools").checked == true) {
		var ib = event.pageX - document.getElementById('imageCropper').offsetLeft; 
        var bo = event.pageY - document.getElementById('imageCropper').offsetTop;
        var per = document.getElementById('canvasBrush').value;
        ct.fillRect(ib+12,bo,per,per);
    }
	else if (draw == true && document.getElementById("showDrawingTools").checked == false) {
		moveCoords[2] = event.pageX - document.getElementById('imageCropper').offsetLeft;
		moveCoords[3] = event.pageY - document.getElementById('imageCropper').offsetTop;
		var moveX =	moveCoords[2] - moveCoords[0];
		var moveY = moveCoords[3] - moveCoords[1];
		document.getElementById("canvasLeft").value = moveX;
		document.getElementById("canvasTop").value = moveY;
		/*
		var x = parseInt(document.getElementById("canvasLeft").value);
		var y = parseInt(document.getElementById("canvasTop").value);
		document.getElementById("canvasLeft").value = x + moveX;
		document.getElementById("canvasTop").value = y + moveY;
		*/
		ct.clearRect(0,0,document.getElementById('imageCropper').width,document.getElementById('imageCropper').height);
		reDrawImage();
	}
});

document.getElementById('clearRectBandit').addEventListener("click", function() {
    ct.clearRect(0,0,document.getElementById('imageCropper').width,document.getElementById('imageCropper').height);
});

document.getElementById('canvasBrushColour').addEventListener("change", function() {
    ct.fillStyle = document.getElementById('canvasBrushColour').value;
    document.getElementById('canvasBrushColour').style.color = ct.fillStyle = document.getElementById('canvasBrushColour').value;
});

for (var i = 0; i < document.getElementsByName("inputType").length; i++) {
    document.getElementsByName("inputType")[i].addEventListener("change",function () {
        changeInput(this.value);
    });
}

document.getElementById("URLBandit").addEventListener("change", function() {
    huhu.src = document.getElementById("URLBandit").value;
    reDrawImage();  
});

document.getElementById("fileText").addEventListener("change", function (event) {
	this.value = replaceInvalidCharacters(this.value);
});
/*
document.getElementById("binaryButton").addEventListener("click", function () {
	document.getElementById("fileData").value = document.getElementById('imageCropper').toDataURL().split(",")[1];
	document.getElementById("imgSave").submit();
});
*/
document.getElementById("downloadBandit").addEventListener("click", function() {
	downloadImage(document.getElementById("fileText").value + "." + document.getElementById("fileType").value,document.getElementById('imageCropper').toDataURL());
});

document.getElementById('rightBar').addEventListener("mousedown", function() {
	resizeX = true;
});

document.getElementById('bottomBar').addEventListener("mousedown", function() {
	resizeY = true;
});

document.addEventListener("mouseup", function() {
	resizeX = false;
	resizeY = false;
});

document.getElementById('imageZone').addEventListener("mousemove", function(event) {
    if (resizeX == true) {
		var ib = event.pageX - document.getElementById('imageCropper').offsetLeft;
		document.getElementById('bottomBar').style.width = ib + "px";
		document.getElementById('imageCropper').width = ib;		
        document.getElementById('canvasWidth').value = ib;
		reDrawImage();
    }
	if (resizeY == true) {
		var bo = event.pageY - document.getElementById('imageCropper').offsetTop;
		document.getElementById('rightBar').style.height = bo + "px";
		document.getElementById('imageCropper').height = bo;		
        document.getElementById('canvasHeight').value = bo;
		reDrawImage();
    }
});

document.getElementById("showDrawingTools").addEventListener("click", function(event) {
	this.checked == true ? document.getElementById("drawingTools").style.display = "block" : document.getElementById("drawingTools").style.display = "none";
});

document.getElementById("showFilters").addEventListener("click", function(event) {
	this.checked == true ? document.getElementById("filters").style.display = "block" : document.getElementById("filters").style.display = "none";
});

document.getElementById("hideTools").addEventListener("click", function(event) {
	this.checked != true ? document.getElementById("editField").style.display = "block" : document.getElementById("editField").style.display = "none";
});

document.addEventListener("keydown", function(event) {
	//event.preventDefault();
	var x = parseInt(document.getElementById("canvasLeft").value);
	var y = parseInt(document.getElementById("canvasTop").value);
	switch(event.keyCode) {
		case 37 : document.getElementById("canvasLeft").value = x - 1; ct.clearRect(0,0,document.getElementById('imageCropper').width,document.getElementById('imageCropper').height);reDrawImage();break;
		case 38 : document.getElementById("canvasTop").value = y - 1; ct.clearRect(0,0,document.getElementById('imageCropper').width,document.getElementById('imageCropper').height);reDrawImage();break;
		case 39 : document.getElementById("canvasLeft").value = x + 1; ct.clearRect(0,0,document.getElementById('imageCropper').width,document.getElementById('imageCropper').height);reDrawImage();break;
		case 40 : document.getElementById("canvasTop").value = y + 1; ct.clearRect(0,0,document.getElementById('imageCropper').width,document.getElementById('imageCropper').height);reDrawImage();break;
		
	}
});

document.getElementById("grayScaleFilter").addEventListener("click",function() {
	grayScale("imageCropper");
});

document.getElementById("invertFilter").addEventListener("click",function() {
	invert("imageCropper");
});

document.getElementById("brightnessFilter").addEventListener("change",function(event) {
	brighten("imageCropper",-(this.value));
	this.value = 0;
});

document.getElementById("redFilter").addEventListener("change",function(event) {
	makeRed("imageCropper",-(this.value));
	this.value = 0;
});

document.getElementById("greenFilter").addEventListener("change",function(event) {
	makeGreen("imageCropper",-(this.value));
	this.value = 0;
});

document.getElementById("blueFilter").addEventListener("change",function(event) {
	makeBlue("imageCropper",-(this.value));
	this.value = 0;
});

document.getElementById("alphaFilter").addEventListener("change",function(event) {
	makeAlpha("imageCropper",this.value);
	this.value = 0;
});

document.getElementById("thresholdFilter").addEventListener("change",function(event) {
	threshold("imageCropper",this.value);
	this.value = 0;
});	

document.getElementById("noiseFilter").addEventListener("change",function(event) {
	noise("imageCropper",this.value);
	this.value = 0;
});	

document.getElementById("saturateFilter").addEventListener("change",function(event) {
	saturate("imageCropper",this.value);
	this.value = 0;
});	
	
	document.getElementById("slider").addEventListener("mousedown", function() {
		sliding = true;
	}); 
	
	window.addEventListener("mouseup", function(event) {
		if (sliding == true) {
			document.getElementById("editField").style.width = (window.innerWidth -  event.pageX) + "px";
			sliding = false;
		}
	});
	
	window.addEventListener("mousemove", function(event) {
		if (sliding == true) {
			document.getElementById("editField").style.width = (window.innerWidth -  event.pageX) + "px";
		}
	}
	);
/*
	app.controller("uploadController", function($scope,$http,$sce) {
			var onError = function (reason) {
				ohSnap("Fejl", {'color': 'Red','duration':'2000'});
                // alert(reason.statusText);
            };
			
			var onuploadeready = function (response) {
				ct.clearRect(0,0,document.getElementById('imageCropper').width,document.getElementById('imageCropper').height);
				huhu.src = document.getElementById('imageCropper').toDataURL();
				reDrawImage(); 
				ohSnap("Opdateret", {'color': 'green','duration':'2000'});
				document.getElementById("fileText").value = "";
				document.getElementById('fileDescription').value = "";
				document.getElementById("fileType").value = "";
                // alert(response.status);
            };
			
		$scope.upload = function () {
			var uploadImage = {
				"data" : document.getElementById('imageCropper').toDataURL().split(",")[1],
				"url" : new Date().toJSON().slice(0,10) + "-Thor-" + document.getElementById('fileText').value + "." + document.getElementById('fileType').value,
				"title" : document.getElementById('fileDescription').value
			};
			$http.post('../includes/http/uploadImage.php/', uploadImage)
             .then(onuploadeready, onError);
		}
	});

	var box;
	window.messageBox = function (sticky) {
	$("#messageBox").stop().fadeIn(1000);
		// document.getElementById("messageBox").innerHTML = "<span id='spanX' onclick='clearBox()'>X</span>" + data; 
		document.getElementById("messageBox").style.bottom = ((window.innerHeight - document.getElementById("messageBox").offsetHeight) / 2) + "px"; 
		// document.getElementById("messageBox").style.bottom = (window.innerHeight / 2) - (document.getElementById("messageBox").offsetHeight / 2) + "px";
		// document.getElementById("messageBox").style.maxHeight = "calc(" + window.innerHeight + "px - 50vh";
		clearTimeout(box);
		if (sticky != true) {
			box = setTimeout(function() {
			$("#messageBox").stop().fadeOut(4000);
			}, 10000); 

		}
	}
*/
</script>
</body>
</html>